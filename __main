import json
import datetime
import os
# import własnych funkcji 
from password_genertor import password_generator
import menu_functions

os.getcwd()

logged = False
login = ''
password = ''
users = {}


#this function draws menu + current date 
menu_functions.menu()
menu_login_yes_no = input('Y/N? ').upper()

try:
    with open('users.txt','r') as file:
        data = file.read()
        users = json.loads(data)
except:
    print('\n')

while logged == False:
    #funkcja if pytajaca czy uzytkownik posiada konto
    if menu_login_yes_no == 'Y':
        has_account = input('Czy posiadasz już konto? Y/N? ').upper()
        #funkcja if pytająca czy chce utworzyć konto, gdzy go nie ma
        if has_account == 'Y':
            login = input('Podaj login: ')
            password = input('Podaj hasło: ')
                # sprawdzenie czy login i password istnieją
            if login in users and users[login] == password:
                print('Zalogowałeś się')
                with open('logi.txt','a') as file:
                    file.write('Uzytkownik '+ str(login) + ' zalogował się ' + str(datetime.datetime.now().strftime('%Y-%m-%d %H:%M:%S')))
                    file.write('\n')
                input('Press any key')
                logged = True

        elif has_account == 'N':
            create_account = input('Czy chcesz utworzyć konto? Y/N ? ').upper()
        # tworzenie login i password
            if create_account == 'Y':
                login = input('Podaj swój nowy login: ')
                choose_password = input('Hasło automatyczne (1). Hasło własne (0): ')

                if choose_password == '0':
                    password = input('Podaj hasło: ')
                else:
                    password = password_generator()
                    print('Oto twoje hasło: ',password)      
            else:
                password = password_generator()
                continue

        new_data = {login:password}
        users.update(new_data)
        with open('users.txt','w') as file:
            file.write(json.dumps(users))

        continue
    else:
        print('Zamykam program')
        break
